{"remainingRequest":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue","mtime":1636646441758},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEJhc2VUYWJsZSB9IGZyb20gIkAvY29tcG9uZW50cyI7CmltcG9ydCBBUEkgZnJvbSAiLi4vYXBpL0FQSSI7CmltcG9ydCB7IE1vZGFsIH0gZnJvbSAiQC9jb21wb25lbnRzIjsKCmNvbnN0IHRhYmxlQ29sdW1ucyA9IFsiTmFtZSIsICJBbW91bnQiLCAiU3RhdHVzIiwgIkRhdGUgUGFpZCJdOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEJhc2VUYWJsZSwgCiAgICBNb2RhbAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgICB4TW9kYWw6IGZhbHNlLAogICAgICB0YWJsZTE6IHsKICAgICAgICB0aXRsZTogIkJpbGxzIiwKICAgICAgICBjb2x1bW5zOiBbLi4udGFibGVDb2x1bW5zXSwKICAgICAgICBkYXRhOiBbXQogICAgICB9LAogICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICBmdWxsZGF0YTogW10KICAgIH07CiAgfSwKICBjb21wdXRlZDp7CiAgICB5ZWFyKCl7CiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAKICAgICAgcmV0dXJuICJCaWxscyAoIiArIGRhdGUuZ2V0RnVsbFllYXIoKSArICIpIgogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZ29UbyhpdGVtKSB7CiAgICAgIGNvbnN0IHRva2VuID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpOwogICAgICBpdGVtLnBhaWQgPSB0cnVlOwogICAgICB2YXIgY291bnQgPSAwOwogICAgICB2YXIgZGF0YSA9IHRoaXMudGFibGUxLmRhdGEuc2xpY2UoKS5yZXZlcnNlKCk7CiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICB2YXIgc3RyaW5nX2RhdGUgPSBTdHJpbmcoZGF0ZSkuc3Vic3RyaW5nKDQsIDI0KTsKICAgICAgZm9yICh2YXIgYXJyIG9mIGRhdGEpIHsKICAgICAgICBpZiAoYXJyLm5hbWUgPT0gaXRlbS5uYW1lKSB7CiAgICAgICAgICBhcnIuZGF0ZSA9IHN0cmluZ19kYXRlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvdW50ICs9IDE7CiAgICAgIH0KCiAgICAgIAogICAgICAKICAgICAgdHJ5IHsKICAgICAgICAKICAgICAgICBjb25zdCByZXN1bHQgPSBBUEkuc3RyaXBldXBkYXRlKHsgY291bnQsIGRhdGU6IHN0cmluZ19kYXRlIH0sIHRva2VuKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgIH0KCiAgICAgIHdpbmRvdy5vcGVuKGl0ZW0ubGluayk7CiAgICB9LAogICAgc2hvd01vZGFsKCkgewogICAgICB0aGlzLnhNb2RhbCA9IHRydWU7CiAgICB9LAogICAgY2xvc2VNb2RhbCgpIHsKICAgICAgdGhpcy54TW9kYWwgPSBmYWxzZTsKICAgIH0KICAgIAogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgICAKICAgIGNvbnN0IHRva2VuID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpOwogICAgdHJ5IHsKICAgICAgCiAgICAgIAogICAgICAgIGNvbnN0IHJlczEgPSBhd2FpdCBBUEkuZmluZFByb2ZpbGUodG9rZW4pCiAgICAgICAgY29uc3QgeyBiaWxscyB9ID0gcmVzMS5kYXRhWzBdCiAgICAgICAgaWYgKCFiaWxscyl7CiAgICAgICAgICB0aGlzLnhNb2RhbCA9IHRydWUKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEFQSS51cGRhdGVGaXJzdCh7YmlsbHM6IHRydWV9LCB0b2tlbikKICAgICAgICB9IAogICAgICAKICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhlcnJvcikKICAgIH0KICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEFQSS5zdHJpcGUodG9rZW4pOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CgogICAgICAKICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpCiAgICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKQogICAgICBmb3IgKHZhciBpbmRleCBpbiByZXN1bHQuZGF0YS5leHRyYWN0ZWQpewogICAgICAgIGlmIChpbmRleCA+PSBtb250aCl7CiAgICAgICAgICBicmVhawogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgcHJpY2UgPSBTdHJpbmcocmVzdWx0LmRhdGEuZXh0cmFjdGVkW2luZGV4XS5wcmljZSk7CiAgICAgICAgICBwcmljZSA9ICIkIiArIHByaWNlLnN1YnN0cmluZygwLHByaWNlLmxlbmd0aC0yKSArICIuIiArIHByaWNlLnN1YnN0cihwcmljZS5sZW5ndGgtMiwgMikKICAgICAgICAgIHJlc3VsdC5kYXRhLmV4dHJhY3RlZFtpbmRleF0ucHJpY2UgPSBwcmljZQogICAgICAgICAgdGhpcy50YWJsZTEuZGF0YS5wdXNoKHJlc3VsdC5kYXRhLmV4dHJhY3RlZFtpbmRleF0pCiAgICAgICAgICB0aGlzLmZ1bGxkYXRhLnB1c2gocmVzdWx0LmRhdGEuZXh0cmFjdGVkW2luZGV4XSkKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIAogICAgICB0aGlzLnRhYmxlMS5kYXRhID0gdGhpcy50YWJsZTEuZGF0YS5yZXZlcnNlKCkKICAgICAgdGhpcy5mdWxsZGF0YSA9IHRoaXMuZnVsbGRhdGEucmV2ZXJzZSgpCiAgICAgIAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5sb2coZXJyb3IpCiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["Bills.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Bills.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n\n<div>\n<div v-if=\"xModal\">\n          <modal class=\"my-modal\"\n            :show.sync=\"xModal\"\n            :centered=\"false\"\n            :show-close=\"true\"\n          >\n            <template v-slot:header class='bg-gradient-dark'>\n              \n            </template>\n              <h2 class='text-success'>This is the Bills Page</h2>\n\n            <h4>Under this page, you will be able to view the breakdown of your bills and utility consumption.</h4>\n            \n            <br>\n            <h4 class='text-primary'>Click anywhere to continue </h4>\n                      \n            <template v-slot:close-button>\n            </template>\n          </modal>\n           </div>\n\n  <div class=\"row\">\n    <div class=\"col-12\">\n      <card :title=\"year\" class=\"relative\">\n        <div class=\"table\">\n          <!-- <loading :loaded=\"isLoading\"/> -->\n          <div v-if=\"!isLoading\" class=\"loader\">\n            <vue-simple-spinner message=\"Please wait while we retrieve your bills\"></vue-simple-spinner>\n          </div>\n          <base-table\n            :data=\"table1.data\"\n            :columns=\"table1.columns\"\n            thead-classes=\"text-primary\"\n            :fulldata=\"fulldata\"\n            @goTo=\"goTo\"\n          >\n          </base-table>\n        </div>\n      </card>\n    </div>\n  </div>\n</div>\n\n</template>\n\n<script>\nimport { BaseTable } from \"@/components\";\nimport API from \"../api/API\";\nimport { Modal } from \"@/components\";\n\nconst tableColumns = [\"Name\", \"Amount\", \"Status\", \"Date Paid\"];\n\nexport default {\n  components: {\n    BaseTable, \n    Modal\n  },\n  data() {\n    return {\n       xModal: false,\n      table1: {\n        title: \"Bills\",\n        columns: [...tableColumns],\n        data: []\n      },\n      isLoading: false,\n      fulldata: []\n    };\n  },\n  computed:{\n    year(){\n      const date = new Date();\n      \n      return \"Bills (\" + date.getFullYear() + \")\"\n    }\n  },\n  methods: {\n    async goTo(item) {\n      const token = window.localStorage.getItem(\"token\");\n      item.paid = true;\n      var count = 0;\n      var data = this.table1.data.slice().reverse();\n      const date = new Date();\n      var string_date = String(date).substring(4, 24);\n      for (var arr of data) {\n        if (arr.name == item.name) {\n          arr.date = string_date;\n          break;\n        }\n        count += 1;\n      }\n\n      \n      \n      try {\n        \n        const result = API.stripeupdate({ count, date: string_date }, token);\n      } catch (error) {\n        console.log(error);\n      }\n\n      window.open(item.link);\n    },\n    showModal() {\n      this.xModal = true;\n    },\n    closeModal() {\n      this.xModal = false;\n    }\n    \n  },\n  async mounted() {\n     \n    const token = window.localStorage.getItem(\"token\");\n    try {\n      \n      \n        const res1 = await API.findProfile(token)\n        const { bills } = res1.data[0]\n        if (!bills){\n          this.xModal = true\n          const result = await API.updateFirst({bills: true}, token)\n        } \n      \n      \n    } catch (error) {\n      console.log(error)\n    }\n    try {\n      const result = await API.stripe(token);\n      this.isLoading = true;\n\n      \n      var date = new Date()\n      var month = date.getMonth()\n      for (var index in result.data.extracted){\n        if (index >= month){\n          break\n        } else {\n          var price = String(result.data.extracted[index].price);\n          price = \"$\" + price.substring(0,price.length-2) + \".\" + price.substr(price.length-2, 2)\n          result.data.extracted[index].price = price\n          this.table1.data.push(result.data.extracted[index])\n          this.fulldata.push(result.data.extracted[index])\n        }\n      }\n      \n      \n      this.table1.data = this.table1.data.reverse()\n      this.fulldata = this.fulldata.reverse()\n      \n    } catch (error) {\n      console.log(error)\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\nbutton {\n  border-radius: 10px;\n  text-align: center;\n  margin: auto;\n}\n.relative{\n  position: relative;\n}\n.loader{\n  position: absolute;\n  top: 150%;\n  left: 37%;\n}\n</style>\n"]}]}