{"remainingRequest":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue","mtime":1636379256471},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEJhc2VUYWJsZSB9IGZyb20gIkAvY29tcG9uZW50cyI7CmltcG9ydCBBUEkgZnJvbSAiLi4vYXBpL0FQSSI7CmltcG9ydCB7IE1vZGFsIH0gZnJvbSAiQC9jb21wb25lbnRzIjsKCmNvbnN0IHRhYmxlQ29sdW1ucyA9IFsiTmFtZSIsICJBbW91bnQiLCAiU3RhdHVzIiwgIkRhdGUgUGFpZCJdOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEJhc2VUYWJsZSwgCiAgICBNb2RhbAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgICB4TW9kYWw6IGZhbHNlLAogICAgICB0YWJsZTE6IHsKICAgICAgICB0aXRsZTogIkJpbGxzIiwKICAgICAgICBjb2x1bW5zOiBbLi4udGFibGVDb2x1bW5zXSwKICAgICAgICBkYXRhOiBbXQogICAgICB9LAogICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBnb1RvKGl0ZW0pIHsKICAgICAgY29uc3QgdG9rZW4gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuIik7CiAgICAgIGl0ZW0ucGFpZCA9IHRydWU7CiAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgIHZhciBkYXRhID0gdGhpcy50YWJsZTEuZGF0YS5zbGljZSgpLnJldmVyc2UoKTsKICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgIHZhciBzdHJpbmdfZGF0ZSA9IFN0cmluZyhkYXRlKS5zdWJzdHJpbmcoNCwgMjQpOwogICAgICBmb3IgKHZhciBhcnIgb2YgZGF0YSkgewogICAgICAgIGlmIChhcnIubmFtZSA9PSBpdGVtLm5hbWUpIHsKICAgICAgICAgIGFyci5kYXRlID0gc3RyaW5nX2RhdGU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY291bnQgKz0gMTsKICAgICAgfQoKICAgICAgCiAgICAgIAogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IEFQSS5zdHJpcGV1cGRhdGUoeyBjb3VudCwgZGF0ZTogc3RyaW5nX2RhdGUgfSwgdG9rZW4pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgfQoKICAgICAgd2luZG93Lm9wZW4oaXRlbS5saW5rKTsKICAgIH0sCiAgICBzaG93TW9kYWwoKSB7CiAgICAgIHRoaXMueE1vZGFsID0gdHJ1ZTsKICAgIH0sCiAgICBjbG9zZU1vZGFsKCkgewogICAgICB0aGlzLnhNb2RhbCA9IGZhbHNlOwogICAgfQogICAgCiAgfSwKICBhc3luYyBtb3VudGVkKCkgewogICAgIAogICAgY29uc3QgdG9rZW4gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuIik7CiAgICB0cnkgewogICAgICAKICAgICAgCiAgICAgICAgY29uc3QgcmVzMSA9IGF3YWl0IEFQSS5maW5kUHJvZmlsZSh0b2tlbikKICAgICAgICBjb25zdCB7IGJpbGxzIH0gPSByZXMxLmRhdGFbMF0KICAgICAgICBpZiAoIWJpbGxzKXsKICAgICAgICAgIHRoaXMueE1vZGFsID0gdHJ1ZQogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgQVBJLnVwZGF0ZUZpcnN0KHtiaWxsczogdHJ1ZX0sIHRva2VuKQogICAgICAgIH0gCiAgICAgIAogICAgICAKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUubG9nKGVycm9yKQogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgQVBJLnN0cmlwZSh0b2tlbik7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKCiAgICAgIAogICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCkKICAgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRNb250aCgpCiAgICAgIGZvciAodmFyIGluZGV4IGluIHJlc3VsdC5kYXRhLmV4dHJhY3RlZCl7CiAgICAgICAgaWYgKGluZGV4ID49IG1vbnRoKXsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBwcmljZSA9IFN0cmluZyhyZXN1bHQuZGF0YS5leHRyYWN0ZWRbaW5kZXhdLnByaWNlKTsKICAgICAgICAgIHByaWNlID0gIiQiICsgcHJpY2Uuc3Vic3RyaW5nKDAscHJpY2UubGVuZ3RoLTIpICsgIi4iICsgcHJpY2Uuc3Vic3RyKHByaWNlLmxlbmd0aC0yLCAyKQogICAgICAgICAgcmVzdWx0LmRhdGEuZXh0cmFjdGVkW2luZGV4XS5wcmljZSA9IHByaWNlCiAgICAgICAgICB0aGlzLnRhYmxlMS5kYXRhLnB1c2gocmVzdWx0LmRhdGEuZXh0cmFjdGVkW2luZGV4XSkKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGxhc3RfeWVhciA9IHJlc3VsdC5kYXRhLmV4dHJhY3RlZC5zcGxpY2UobW9udGgsIDEyLW1vbnRoKQogICAgICBsYXN0X3llYXIgPSBsYXN0X3llYXIucmV2ZXJzZSgpCiAgICAgIGZvciAodmFyIGkgaW4gbGFzdF95ZWFyKXsKICAgICAgICAKICAgICAgICAgIHZhciBwcmljZSA9IFN0cmluZyhsYXN0X3llYXJbaV0ucHJpY2UpOwogICAgICAgICAgcHJpY2UgPSAiJCIgKyBwcmljZS5zdWJzdHJpbmcoMCxwcmljZS5sZW5ndGgtMikgKyAiLiIgKyBwcmljZS5zdWJzdHIocHJpY2UubGVuZ3RoLTIsIDIpCiAgICAgICAgICBsYXN0X3llYXJbaV0ucHJpY2UgPSBwcmljZQogICAgICAgICAgdGhpcy50YWJsZTEuZGF0YS51bnNoaWZ0KGxhc3RfeWVhcltpXSkKICAgICAgICAKICAgICAgfQogICAgICAKICAgICAgdGhpcy50YWJsZTEuZGF0YSA9IHRoaXMudGFibGUxLmRhdGEucmV2ZXJzZSgpCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhlcnJvcikKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["Bills.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Bills.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n\n<div>\n<div v-if=\"xModal\">\n          <modal class=\"my-modal\"\n            :show.sync=\"xModal\"\n            :centered=\"false\"\n            :show-close=\"true\"\n          >\n            <template v-slot:header class='bg-gradient-dark'>\n              \n            </template>\n              <h2 class='text-success'>This is the Bills Page</h2>\n\n            <h4>Under this page, you will be able to view the breakdown of your bills and utility consumption.</h4>\n            \n            <br>\n            <h4 class='text-primary'>Click anywhere to continue </h4>\n                      \n            <template v-slot:close-button>\n            </template>\n          </modal>\n           </div>\n\n  <div class=\"row\">\n    <div class=\"col-12\">\n      <card :title=\"table1.title\" class=\"relative\">\n        <div class=\"table\">\n          <!-- <loading :loaded=\"isLoading\"/> -->\n          <div v-if=\"!isLoading\" class=\"loader\">\n            <vue-simple-spinner message=\"Please wait while we retrieve your bills\"></vue-simple-spinner>\n          </div>\n          <base-table\n            :data=\"table1.data\"\n            :columns=\"table1.columns\"\n            thead-classes=\"text-primary\"\n            \n            @goTo=\"goTo\"\n          >\n          </base-table>\n        </div>\n      </card>\n    </div>\n  </div>\n</div>\n\n</template>\n\n<script>\nimport { BaseTable } from \"@/components\";\nimport API from \"../api/API\";\nimport { Modal } from \"@/components\";\n\nconst tableColumns = [\"Name\", \"Amount\", \"Status\", \"Date Paid\"];\n\nexport default {\n  components: {\n    BaseTable, \n    Modal\n  },\n  data() {\n    return {\n       xModal: false,\n      table1: {\n        title: \"Bills\",\n        columns: [...tableColumns],\n        data: []\n      },\n      isLoading: false,\n      \n    };\n  },\n  methods: {\n    async goTo(item) {\n      const token = window.localStorage.getItem(\"token\");\n      item.paid = true;\n      var count = 0;\n      var data = this.table1.data.slice().reverse();\n      const date = new Date();\n      var string_date = String(date).substring(4, 24);\n      for (var arr of data) {\n        if (arr.name == item.name) {\n          arr.date = string_date;\n          break;\n        }\n        count += 1;\n      }\n\n      \n      \n      try {\n        const result = API.stripeupdate({ count, date: string_date }, token);\n      } catch (error) {\n        console.log(error);\n      }\n\n      window.open(item.link);\n    },\n    showModal() {\n      this.xModal = true;\n    },\n    closeModal() {\n      this.xModal = false;\n    }\n    \n  },\n  async mounted() {\n     \n    const token = window.localStorage.getItem(\"token\");\n    try {\n      \n      \n        const res1 = await API.findProfile(token)\n        const { bills } = res1.data[0]\n        if (!bills){\n          this.xModal = true\n          const result = await API.updateFirst({bills: true}, token)\n        } \n      \n      \n    } catch (error) {\n      console.log(error)\n    }\n    try {\n      const result = await API.stripe(token);\n      this.isLoading = true;\n\n      \n      var date = new Date()\n      var month = date.getMonth()\n      for (var index in result.data.extracted){\n        if (index >= month){\n          break\n        } else {\n          var price = String(result.data.extracted[index].price);\n          price = \"$\" + price.substring(0,price.length-2) + \".\" + price.substr(price.length-2, 2)\n          result.data.extracted[index].price = price\n          this.table1.data.push(result.data.extracted[index])\n        }\n      }\n      var last_year = result.data.extracted.splice(month, 12-month)\n      last_year = last_year.reverse()\n      for (var i in last_year){\n        \n          var price = String(last_year[i].price);\n          price = \"$\" + price.substring(0,price.length-2) + \".\" + price.substr(price.length-2, 2)\n          last_year[i].price = price\n          this.table1.data.unshift(last_year[i])\n        \n      }\n      \n      this.table1.data = this.table1.data.reverse()\n    } catch (error) {\n      console.log(error)\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\nbutton {\n  border-radius: 10px;\n  text-align: center;\n  margin: auto;\n}\n.relative{\n  position: relative;\n}\n.loader{\n  position: absolute;\n  top: 150%;\n  left: 37%;\n}\n</style>\n"]}]}