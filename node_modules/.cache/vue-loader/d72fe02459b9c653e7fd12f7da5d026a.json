{"remainingRequest":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue?vue&type=style&index=0&id=2d3b8150&lang=scss&scoped=true&","dependencies":[{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/src/pages/Bills.vue","mtime":1636775201284},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/randallyeo/Desktop/Desktop Items/Y2/Y2S1/WAD2/project/project_deployment/utbuddy_frontend_deploy/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKYnV0dG9uIHsKICBib3JkZXItcmFkaXVzOiAxMHB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBtYXJnaW46IGF1dG87Cn0KLnJlbGF0aXZlewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoubG9hZGVyewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDE1MCU7CiAgbGVmdDogMzclOwp9Cg=="},{"version":3,"sources":["Bills.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Bills.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n\n<div>\n<div v-if=\"xModal\">\n          <modal class=\"my-modal\"\n            :show.sync=\"xModal\"\n            :centered=\"false\"\n            :show-close=\"true\"\n          >\n            <template v-slot:header class='bg-gradient-dark'>\n              \n            </template>\n              <h2 class='text-success'>This is the Bills Page</h2>\n\n            <h4 class='text-dark'>Under this page, you will be able to view the breakdown of your bills and utility consumption.</h4>\n            \n            <br>\n            <h4 class='text-primary'>Click anywhere to continue </h4>\n                      \n            <template v-slot:close-button>\n            </template>\n          </modal>\n           </div>\n\n  <div class=\"row\">\n    <div class=\"col-12\">\n      <card :title=\"year\" class=\"relative\">\n        <div class=\"table\">\n          <!-- <loading :loaded=\"isLoading\"/> -->\n          <div v-if=\"!isLoading\" class=\"loader\">\n            <vue-simple-spinner message=\"Please wait while we retrieve your bills\"></vue-simple-spinner>\n          </div>\n          <base-table\n            :data=\"table1.data\"\n            :columns=\"table1.columns\"\n            thead-classes=\"text-primary\"\n            :fulldata=\"fulldata\"\n            @goTo=\"goTo\"\n          >\n          </base-table>\n        </div>\n      </card>\n    </div>\n  </div>\n</div>\n\n</template>\n\n<script>\nimport { BaseTable } from \"@/components\";\nimport API from \"../api/API\";\nimport { Modal } from \"@/components\";\n\nconst tableColumns = [\"Name\", \"Amount\", \"Status\", \"Date Paid\"];\n\nexport default {\n  components: {\n    BaseTable, \n    Modal\n  },\n  data() {\n    return {\n       xModal: false,\n      table1: {\n        title: \"Bills\",\n        columns: [...tableColumns],\n        data: []\n      },\n      isLoading: false,\n      fulldata: []\n    };\n  },\n  computed:{\n    year(){\n      const date = new Date();\n      \n      return \"Bills (\" + date.getFullYear() + \")\"\n    }\n  },\n  methods: {\n    async goTo(item) {\n      const token = window.localStorage.getItem(\"token\");\n      item.paid = true;\n      var count = 0;\n      var data = this.table1.data.slice().reverse();\n      const date = new Date();\n      var string_date = String(date).substring(4, 24);\n      for (var arr of data) {\n        if (arr.name == item.name) {\n          arr.date = string_date;\n          break;\n        }\n        count += 1;\n      }\n\n      \n      \n      try {\n        \n        const result = API.stripeupdate({ count, date: string_date }, token);\n      } catch (error) {\n        console.log(error);\n      }\n\n      window.open(item.link);\n    },\n    showModal() {\n      this.xModal = true;\n    },\n    closeModal() {\n      this.xModal = false;\n    }\n    \n  },\n  async mounted() {\n     \n    const token = window.localStorage.getItem(\"token\");\n    try {\n      \n      \n        const res1 = await API.findProfile(token)\n        const { bills } = res1.data[0]\n        if (!bills){\n          this.xModal = true\n          const result = await API.updateFirst({bills: true}, token)\n        } \n      \n      \n    } catch (error) {\n      console.log(error)\n    }\n    try {\n      const result = await API.stripe(token);\n      this.isLoading = true;\n\n      \n      var date = new Date()\n      var month = date.getMonth()\n      for (var index in result.data.extracted){\n        if (index >= month){\n          break\n        } else {\n          var price = String(result.data.extracted[index].price);\n          price = \"$\" + price.substring(0,price.length-2) + \".\" + price.substr(price.length-2, 2)\n          result.data.extracted[index].price = price\n          this.table1.data.push(result.data.extracted[index])\n          this.fulldata.push(result.data.extracted[index])\n        }\n      }\n      \n      \n      this.table1.data = this.table1.data.reverse()\n      this.fulldata = this.fulldata.reverse()\n      \n    } catch (error) {\n      console.log(error)\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\nbutton {\n  border-radius: 10px;\n  text-align: center;\n  margin: auto;\n}\n.relative{\n  position: relative;\n}\n.loader{\n  position: absolute;\n  top: 150%;\n  left: 37%;\n}\n</style>\n"]}]}